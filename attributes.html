<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-01-03 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150103" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Soabase &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/randgalt/soabase">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Soabase</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-01-03
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.1.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Soabase</li>
                              
      <li>
  
                          <a href="index.html" title="About">
          <i class="none"></i>
        About</a>
            </li>
                
      <li>
  
                          <a href="usage.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                
      <li>
  
                          <a href="soaconfig.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="example.html" title="Examples">
          <i class="none"></i>
        Examples</a>
            </li>
                              <li class="nav-header">Features</li>
                              
      <li>
  
                          <a href="discovery.html" title="Service Discovery">
          <i class="none"></i>
        Service Discovery</a>
            </li>
                
      <li>
  
                          <a href="client.html" title="REST Client">
          <i class="none"></i>
        REST Client</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Dynamic Attributes</a>
          </li>
                
      <li>
  
                          <a href="admin.html" title="Admin APIs">
          <i class="none"></i>
        Admin APIs</a>
            </li>
                
      <li>
  
                          <a href="console.html" title="Admin Console">
          <i class="none"></i>
        Admin Console</a>
            </li>
                
      <li>
  
                          <a href="config.html" title="Config Utils">
          <i class="none"></i>
        Config Utils</a>
            </li>
                              <li class="nav-header">Details</li>
                              
      <li>
  
                          <a href="source-repository.html" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                
      <li>
  
                          <a href="issue-tracking.html" title="Issues">
          <i class="none"></i>
        Issues</a>
            </li>
                
      <li>
  
                          <a href="apidocs/index.html" title="JavaDoc">
          <i class="none"></i>
        JavaDoc</a>
            </li>
                
      <li>
  
                          <a href="team-list.html" title="Team">
          <i class="none"></i>
        Team</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="project-summary.html" title="Summary">
          <i class="none"></i>
        Summary</a>
            </li>
                
      <li>
  
                          <a href="dependency-management.html" title="Dependencies">
          <i class="none"></i>
        Dependencies</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                   
        
        
        
    <iframe src="http://www.facebook.com/plugins/like.php?href=https://github.com/randgalt/soabase&send=false&layout=box_count&show-faces=false&action=like&colorscheme=light"
        scrolling="no" frameborder="0"
        style="border:none; width:48px; height:63px; margin-top: 10px;" ></iframe>
               <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2><a name="Dynamic_Attributes"></a>Dynamic Attributes</h2>
<p>Distributed, scoped dynamic attributes provide a mechanism to configure/alter your cluster at runtime. Attributes can be changed for all instances of all services in the cluster, only for a particular service, only for a particular instance, etc.</p>
<div class="section">
<h3><a name="Usage"></a>Usage</h3>
<p>Dynamic Attribute support is enabled via configuration. See the <a href="./soaconfig.html#Dynamic_Attributes">Dynamic Attributes Configuration</a> section for details. To use the default JDBC, add <tt>SqlConfiguration</tt> configuration to your application's Configuration object. If needed, you can access the Mybatis <tt>SqlSession</tt> instance from <tt>SoaFeatures</tt>.</p></div>
<div class="section">
<h3><a name="Mybatis"></a>Mybatis</h3>
<p>A nice side-effect of using the standard JDBC integration is that you can directly access the Mybatis SqlSession instance for any other database usage you might have. You can even create multiple SqlSession instances for different databases. Each Sql instance defined in your Configuration is set in SoaFeatures with the configured name.</p>
<p>Even if you don't directly need to access the Mybatis session, you'll need to create a minimal Mybatis configuration file. For most uses, this file will suffice:</p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;Class Name of your JDBC Driver&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;Connection URL for the Driver&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;XXXX&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;XXXX&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
&lt;/configuration&gt;</pre></div>
<p>Whatever database you use, you need to set up the schema for Dynamic Attributes. You can do this manually or via a Soabase utility. The SQL to create the table is:</p>
<div class="source">
<pre>CREATE TABLE SoaAttributes
(
    fKEY VARCHAR(255) NOT NULL,
    fSCOPE VARCHAR(255) NOT NULL,
    fVALUE VARCHAR(65535),
    fTIMESTAMP VARCHAR(255) NOT NULL,
    PRIMARY KEY (fKEY, fSCOPE))
)</pre></div>
<p>To do it programmatically, use the Mybatis session:</p>
<div class="source">
<pre>SoaFeatures features = SoaBundle.getFeatures(environment);
SqlSession session = features.getNamedRequired(SqlSession.class, name);
AttributeEntityMapper mapper = session.getMapper(AttributeEntityMapper.class);
mapper.createTable();</pre></div>
<p>Once the database is set up, you can add attributes manually or via the <a href="./console.html">Administration Console</a>. To add manually, use this SQL (fTIMESTAMP is a GUID):</p>
<div class="source">
<pre>INSERT INTO SoaAttributes (fKEY, fSCOPE, fVALUE, fTIMESTAMP) VALUES (?, ?, ?, ?)</pre></div></div>
<div class="section">
<h3><a name="API"></a>API</h3>
<p>Dynamic Attributes are accessed via the <tt>SoaDynamicAttributes</tt> instance from <tt>SoaFeatures</tt>. It has methods to get attributes coerced to various types, override attributes and listen for changes.</p></div>
<div class="section">
<h3><a name="Adding_a_Custom_Implementation"></a>Adding a Custom Implementation</h3>
<p>To use something other than the JDOBC implementation, follow these steps:</p>
<ul>
<li>Create implementations for <tt>SoaDynamicAttributesFactory</tt> and <tt>SoaWritableDynamicAttributes</tt></li>
<li>Add a directory named <tt>META-INF/services</tt> that contains two files: <tt>io.dropwizard.jackson.Discoverable</tt> and <tt>io.soabase.core.features.attributes.SoaDynamicAttributesFactory</tt>.</li></ul>
<p><i>SoaDynamicAttributesFactory</i></p>
<p>Your SoaDynamicAttributesFactory implementation is like other Dropwizard factories. It should be both configuration and a factory. Use <tt>SqlDynamicAttributesFactory.java</tt> as an example. This class must be annotated with <tt>JsonTypeName</tt> and given a unique name. You then use this name as the value for the discovery type in your configuration file. E.g.</p>
<div class="source">
<pre>package com.me.my;

@JsonTypeName(&quot;my-discovery&quot;)
public class MyAttributesFactory implements SqlDynamicAttributesFactory {
    public String aConfigValue;

    public int anotherConfigValue;

        ...

    @Override
    public SoaDynamicAttributes build(Environment environment, List&lt;String&gt; scopes)
    {
            ...
        return new MyAttributes(...);
    }
}</pre></div>
<p><i>SoaWritableDynamicAttributes</i></p>
<p>Your SoaDynamicAttributes implementation does the actual work. The details will depend on your implementation's needs. Note: your custom class should implement <tt>SoaWritableDynamicAttributes</tt> not <tt>SoaDynamicAttributes</tt>. This allows your implementation to interact with the <a href="./console.html">Administration Console</a>.</p>
<p><i>ServiceLoader files</i></p>
<p>Like other Dropwizard plugins, your Dynamic Attributes implementation needs Service Loader files. In the <tt>io.dropwizard.jackson.Discoverable</tt> file add a line containing: <tt>io.soabase.core.features.attributes.SoaDynamicAttributesFactory</tt>. In the <tt>io.soabase.core.features.attributes.SoaDynamicAttributesFactory</tt> file add a line the with fully-qualified path name of your class. E.g. <tt>com.me.my.MyAttributesFactory</tt></p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014&#x2013;2015
                        <a href="http://soabase.github.io/">Soabase</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
